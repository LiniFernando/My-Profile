<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ghosts in Cards</title>
    <link rel="icon" href="img/ghost.png" type="img/png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../assets/css/normalize.css">
    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="gameCss.css">

<style>
    body{
        background-image: url(img/bg.jpg);
        background-position: left top;
        background-size: cover;
        background-attachment: fixed;
    }

    .board{
        /*width: 640px;*/
        height: 435px;
        display: flex;
        flex-wrap: wrap;
        perspective: 1000px;

        width: 100%;
        padding-right: 15px;
        padding-left: 15px;

        flex: 0 0 41.666667%;
        max-width: 41.666667%;

        position: relative;
        /*display: flex;*/
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-clip: border-box;
        border: 3px solid rgb(155, 113, 38);

        align-self: center!important;

        margin: 10px 30.3333%;
        margin-bottom: 0;
        background-color: rgb(41, 23, 8);
        border-radius: 10px;

    }
    .board-body{
        flex: 1 1 auto;
        padding: 1.25rem;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
    }
    .card {
        width: 140px;
        height: 190px;
        margin: 5px 55px;
        position: relative;
        transform: scale(1);
        transform-style: preserve-3d;
        transition: transform .5s;
        box-shadow: 1px 1px 1px rgba(0,0,0,.3);

    }

    .card:active {
        transform: scale(0.97);
        transition: transform .2s;
    }

    .card.flip {
        transform: rotateY(180deg);
    }

    .card-front,
    .card-back {
        width: 100%;
        height: 100%;
        padding: 20px;
        position: absolute;
        /*border-radius: 5px;*/
        border-radius: 10px;
        border-color: red;
        border-style: ridge;
        background: #00070f;
        backface-visibility: hidden;
    }
    .card-front {
        transform: rotateY(180deg);
    }
</style>
    <script>
        //set minutes
        var mins = 0;


        //calculate the seconds
        var secs = mins * 60;

        var secs =15;
        //countdown function is evoked when page is loaded
        function countdown() {
            setTimeout('Decrement()', 60);
        }

        //Decrement function decrement the value.
        function Decrement() {
            if (document.getElementById) {
                minutes = document.getElementById("minutes");
                seconds = document.getElementById("seconds");

                //if less than a minute remaining
                //Display only seconds value.
                if (seconds < 59) {
                    seconds.value = secs;
                }

                //Display both minutes and seconds
                //getminutes and getseconds is used to
                //get minutes and seconds
                else {
                    minutes.value = getminutes();
                    seconds.value = getseconds();
                }
                //when less than a minute remaining
                //colour of the minutes and seconds
                //changes to red
                if (mins < 1) {
                    minutes.style.color = "red";
                    seconds.style.color = "red";
                }
                //if seconds becomes zero,
                //then page alert time up
                if (mins < 0) {
                    alert('time up');
                    minutes.value = 0;
                    seconds.value = 0;
                }
                //if seconds > 0 then seconds is decremented
                else {
                    secs--;
                    setTimeout('Decrement()', 1000);
                }
            }
        }

        function getminutes() {
            //minutes is seconds divided by 60, rounded down
            mins = Math.floor(secs / 60);
            return mins;
        }

        function getseconds() {
            //take minutes remaining (as seconds) away
            //from total seconds remaining
            return secs - Math.round(mins * 60);
        }
    </script>
</head>
<body onload="countdown();">
<header>
    <audio  src="audio/radionoise.mp3" autoplay loop>
        <embed src="audio/radionoise.mp3" width="180" height="90" hidden="true"/>
    </audio>
    <h1 id="level">Level 1</h1>
    <h3 id="time">00:15</h3>

    <div>
        <input id="minutes" type="text" style="
        width: 25px;
             border: none;
             /*font-size: 16px;*/
            font-weight: bold;
            /*color: black;*/

color: red;
    font-size: 45px;
    font-family: Chiller;
    text-align: center;
        background-color: #ffffff00;
"><font size="5"> :
    </font>
        <input id="seconds" type="text" style="
        width: 50px;
                        border: none;
                        /*font-size: 16px;*/
                        font-weight: bold;
                        /*color: black;*/

color: red;
    font-size: 45px;
    font-family: Chiller;
    text-align: center;
background-color: #ffffff00;">

    </div>

</header>
<!--...................................score board..................................-->
<!--<div id="score_div">
    Score : <span id="score">0</span>
</div>


<div id="pause_btn">
    <img src="image/pauseButton.png" alt="" style="width: 9%">
</div>

<div id="btn-play">
    <img src="img/btnPlay.png" alt="play button" style="width: 10%" id="play">
</div>-->
<!--..............................................................................................-->
<audio id="sound">
    <source src="audio/flipSound.mp3" />
</audio>
<audio id="audio" src="audio/flipSound.mp3" ></audio>
<main>
    <div id="ghostDiv"></div>
    <section class="board" style="">
        <div class="board-body">
            <div class="card" data-framework="aurelia" onclick="play()">
                <img class="card-front" src="img/TW032AP-Fire_Skull_1024x1024.webp" alt="Aurelia" />
                <img class="card-back" src="img/pentagram.png" alt="JS Badge" />
            </div>
            <div class="card" data-framework="aurelia" onclick="play()">
                <img class="card-front" src="img/TW032AP-Fire_Skull_1024x1024.webp" alt="Aurelia" />
                <img class="card-back" src="img/pentagram.png" alt="JS Badge" />
            </div>

            <div class="card" data-framework="vue" onclick="play()">
                <img class="card-front" src="img/ghost.png" alt="Vue" />
                <img class="card-back" src="img/pentagram.png" alt="JS Badge" />
            </div>
            <div class="card" data-framework="vue" onclick="play()">
                <img class="card-front" src="img/ghost.png" alt="Vue" />
                <img class="card-back" src="img/pentagram.png" alt="JS Badge" />
            </div>
        </div>
    </section>
</main>

<!--...................................game over......................................-->
<!--<div id="game-over-box">
    <div style="text-align: center;">
        <img src="image/gameover-colour-logo2.png" alt="Game Over" style="width: 20%">
        <h2 class="score-box">Your Score : <span id="final-score"></span></h2>
        <h2 class="score-box">High Score : <span id="High-score"></span></h2>
        <img id="btn-replay" src="image/Play_Again_Button.png" alt="Play Again" style="width: 10%">
    </div>
</div>-->
<!--................................................................................................-->

    <script src="../../assets/js/jquery-3.4.1.min.js"></script>
    <script src="../../assets/js/code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js" ></script>
<!--<script>

    const btnPlay = $('#play');

    const line_1 = $('#line1');
    const line_2 = $('#line2');
    const line_3 = $('#line3');

    // const line_speed = 1;

    const car_1 = $('#car1');
    const car_2 = $('#car2');
    const car_3 = $('#car3');
    const car_width = car_1.width();

    var speed = 2;

    const my_car = $('#car');
    const my_car_width = my_car.width();
    const my_car_height = my_car.height();

    var move_up = false;
    var move_down = false;
    var move_left = false;
    var move_right = false;

    let gameHeight = $('.wrapper').height();
    let gameWidth = $('.wrapper').width();

    const score = $('#score');
    let score_interval;

    let stepY = 5;
    let stepX = 3;
    let score_count = 1;
    let score_div = $('#score_div');

    const game_over_box = $('#game-over-box');
    const final_score = $('#final-score');
    const high_score = $('#High-score');

    const btnplay_again = $('#btn-replay');

    let frameId = 0;
    let nextBar = null;
    let isHit = false;

    // -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;Game Starts here&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;//

    btnplay_again.click(function () {
        window.location.reload();
    });

    btnPlay.click(function () {

        $('#btn-play').fadeOut();
        score_div.fadeIn();
        countScore();

        function processGame() {
            frameId = requestAnimationFrame(function () {
                moveRoad();
                countScore();
                appearRandomCars();
                if (isCollide(my_car, car_1) || isCollide(my_car, car_2) || isCollide(my_car, car_3)) {
                    isHit = true;
                    cancelAnimationFrame(frameId);
                    $(document).off('keydown');
                }
                if (!isHit) {
                    processGame();
                }else {
                    $('.wrapper').css('filter', 'brightness(40%)');
                    game_over_box.fadeIn();
                    score_div.fadeOut();
                    final_score.text(score.text());
                    setHighScore(score.text());
                }
            });
        } processGame();

        $(document).on('keydown', function(e) {
            var key = e.keyCode;
            if (key === 37 && move_left === false) {
                move_left = requestAnimationFrame(left);
            } else if (key === 39 && move_right === false) {
                move_right = requestAnimationFrame(right);
            } else if (key === 38 && move_up === false) {
                move_up = requestAnimationFrame(up);
            } else if (key === 40 && move_down === false) {
                move_down = requestAnimationFrame(down);
            }
        });

        $(document).on('keyup', function(e) {
            var key = e.keyCode;
            if (key === 37) {
                cancelAnimationFrame(move_left);
                move_left = false;
            } else if (key === 39) {
                cancelAnimationFrame(move_right);
                move_right = false;
            } else if (key === 38) {
                cancelAnimationFrame(move_up);
                move_up = false;
            } else if (key === 40) {
                cancelAnimationFrame(move_down);
                move_down = false;
            }
        });

        function left() {
            if (parseInt(my_car.css('left')) > 0) {
                my_car.css('left', parseInt(my_car.css('left')) - stepX);
                move_left = requestAnimationFrame(left);
            }
        }

        function right() {
            if (parseInt(my_car.css('left')) < gameWidth - my_car_width) {
                my_car.css('left', parseInt(my_car.css('left')) + stepX);
                move_right = requestAnimationFrame(right);
            }
        }

        function up() {
            if (parseInt(my_car.css('top')) > 0) {
                my_car.css('top', parseInt(my_car.css('top')) - stepY);
                move_up = requestAnimationFrame(up);
            }
        }

        function down() {
            if (parseInt(my_car.css('top')) < gameHeight - my_car_height) {
                my_car.css('top', parseInt(my_car.css('top')) + stepY);
                move_down = requestAnimationFrame(down);
            }
        }

    });

    function moveRoad() {
        const line_1_top = parseInt(line_1.css('top'));
        const line_2_top = parseInt(line_2.css('top'));
        const line_3_top = parseInt(line_3.css('top'));
        const resetPos = -150;
        const gap = 150;

        if (line_1_top >= gameHeight) {
            nextBar = line_1;
        }else {
            line_1.css('top', line_1_top + stepY);
        }

        if (line_2_top >= gameHeight) {
            nextBar = line_2;
        } else {
            line_2.css('top', line_2_top + stepY);
        }

        if (line_3_top >= gameHeight) {
            nextBar = line_3;
        } else {
            line_3.css('top', line_3_top + stepY);
        }

        if (line_3_top === gap && nextBar !== null) {
            nextBar.css('top', resetPos);
        }
        if (line_2_top === gap && nextBar !== null) {
            nextBar.css('top', resetPos);
        }
        if (line_1_top === gap && nextBar !== null) {
            nextBar.css('top', resetPos);
        }
    }

    function appearRandomCars(){
        car_down(car_1);
        car_down(car_2);
        car_down(car_3);
    }

    function car_down(car){
        var current_top = parseInt(car.css('top'));
        let top_rand = 0;
        if (current_top > gameHeight){
            current_top = -200;
            var car_left = parseInt(Math.random() * (gameWidth - my_car_width));
            top_rand = Math.floor(Math.random() * 100);
            car.css('left', car_left);
        }
        car.css('top', current_top + speed - top_rand);
    }

    function isCollide($div1, $div2) {
        var x1 = $div1.offset().left;
        var y1 = $div1.offset().top;
        var h1 = $div1.outerHeight(true);
        var w1 = $div1.outerWidth(true);
        var b1 = y1 + h1;
        var r1 = x1 + w1;
        var x2 = $div2.offset().left;
        var y2 = $div2.offset().top;
        var h2 = $div2.outerHeight(true);
        var w2 = $div2.outerWidth(true);
        var b2 = y2 + h2;
        var r2 = x2 + w2;

        return !(b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2);
    }

    function countScore() {
        score_count++;

        if (score_count % 20 == 0) {
            score.text(parseInt(score.text()) + 1);
        }
        if (score_count % 500 == 0) {
            speed++;
        }

    }

    function setHighScore(score) {
        let highScore = parseInt(localStorage.getItem('high_score')) || 0;
        if (parseInt(score) > highScore){
            localStorage.setItem('high_score', score);
        }
        high_score.text(localStorage.getItem('high_score'));
    }
</script>-->

<script>
    function play(){
        var audio = document.getElementById("audio");
        audio.play();
    }
</script>
<script>
    const cards = document.querySelectorAll('.card');

    let hasFlippedCard = false;
    let lockBoard = false;
    let firstCard, secondCard;

    function flipCard() {
        if (lockBoard) return;
        if (this === firstCard) return;

        this.classList.add('flip');

        if (!hasFlippedCard) {
            hasFlippedCard = true;
            firstCard = this;
            return;
        }

        secondCard = this;
        lockBoard = true;

        checkForMatch();
    }

    function checkForMatch() {
        let isMatch = firstCard.dataset.framework === secondCard.dataset.framework;
        isMatch ? disableCards() : unflipCards();
    }

    function disableCards() {
        firstCard.removeEventListener('click', flipCard);
        secondCard.removeEventListener('click', flipCard);

        resetBoard();
    }

    function unflipCards() {
        setTimeout(() => {
            firstCard.classList.remove('flip');
            secondCard.classList.remove('flip');

            resetBoard();
        }, 1500);
    }

    function resetBoard() {
        [hasFlippedCard, lockBoard] = [false, false];
        [firstCard, secondCard] = [null, null];
    }

    (function shuffle() {
        cards.forEach(card => {
            let ramdomPos = Math.floor(Math.random() * 12);
            card.style.order = ramdomPos;
        });
    })();

    cards.forEach(card => card.addEventListener('click', flipCard));
</script>
</body>
</html>